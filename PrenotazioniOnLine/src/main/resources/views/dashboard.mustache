<!DOCTYPE html>
<html lang="it">
<head>
<title>Sistema di Prenotazione Carta di Identità Digitale -
	Comune di San Miniato</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link href='/assets/calendar/fullcalendar.css' rel='stylesheet' />
<link href='/assets/calendar/fullcalendar.print.css' rel='stylesheet'
	media='print' />
<script src="/assets/calendar/lib/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script src='/assets/calendar/lib/moment.min.js'></script>
<script src='/assets/calendar/fullcalendar.js'></script>
<script>
	$(document).ready(function() {
		$("#SelezioneUfficio").on('change', function() {
			var selected = []
			selected = $('#SelezioneUfficio').val()
			var moment = $('#calendar').fullCalendar('getDate');
			$('#calendar').fullCalendar('removeEventSources');
			$('#calendar').fullCalendar('removeEvents');
			$('#calendar').fullCalendar('addEventSource', {
				url : '/disponibilita?place=' + selected,
				type : 'GET', // Send post data
				error : function() {
					alert('There was an error while fetching events.');
				}
			});

			$('#calendar').fullCalendar('rerenderEvents');

		});

		$('#calendar').fullCalendar({
			header : {
				left : 'prev,next today',
				center : 'title',
				right : 'month,agendaWeek,agendaDay'
			},
			editable : true,
			eventLimit : true, // allow "more" link when too many events
			events : [],
			eventClick : function(calEvent, jsEvent, view) {

				$(this).css('border-color', 'red');

				$.ajax({
					type : "PUT",
					dataType : "json",
					url : "/disponibilita/reserve/" + calEvent.id,
					success : function(data) {
						$('#calendar').fullCalendar('refetchEvents');

						$("#prenotazioneModale").modal('show');
					},
					error : function(xhr, ajaxOptions, thrownError) {
						alert(xhr.status);
						alert(thrownError);
					}
				});

			},
			dayClick : function(date, jsEvent, view) {

				alert('Clicked on: ' + date.format());

				alert('Coordinates: ' + jsEvent.pageX + ',' + jsEvent.pageY);

				alert('Current view: ' + view.name);

				// change the day's background color just for fun
				$(this).css('background-color', 'red');

			}
		});

	});
</script>
<style>
body {
	margin: 0;
	padding: 0;
	font-family: "Lucida Grande", Helvetica, Arial, Verdana, sans-serif;
	font-size: 14px;
}

#script-warning {
	display: none;
	background: #eee;
	border-bottom: 1px solid #ddd;
	padding: 0 10px;
	line-height: 40px;
	text-align: center;
	font-weight: bold;
	font-size: 12px;
	color: red;
}

#loading {
	display: none;
	position: absolute;
	top: 10px;
	right: 10px;
}

#calendar {
	max-width: 900px;
	margin: 40px auto;
	padding: 0 10px;
}
</style>
</head>

<body>
	<div id='script-warning'>
		<code>Connessione Server Assente</code>
	</div>

	<!-- Modal HTML -->
	<div id="prenotazioneModale" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title">Scheda di prenotazione</h4>
				</div>
				<div class="modal-body">
				
					<form id="schedaprenotazione" method="post" class="form-horizontal">
						<div class="form-group">
							<label class="col-xs-3 control-label">Nome</label>
							<div class="col-xs-5">
								<input type="text" class="form-control" name="nome" required />
							</div>
						</div>

						<div class="form-group">
							<label class="col-xs-3 control-label">Cognome</label>
							<div class="col-xs-5">
								<input type="text" class="form-control" name="cognome" required />
							</div>
						</div>

						<div class="form-group">
							<div class="col-xs-5 col-xs-offset-3">
								<button type="submit" class="btn btn-primary">Prenota</button>
								<button type="button" class="btn btn-default"
									data-dismiss="modal">Annulla</button>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					<button type="button" class="btn btn-primary">Save changes</button>
				</div>
			</div>
		</div>
	</div>


	<div class="container">
		<h1>Sistema di Prenotazione appuntamenti per la Carta di Identità
			Digitale</h1>
		<h2>San Miniato</h2>

		<p>Effettuare la selezione della prenotazione</p>

		<select id="SelezioneUfficio" class="form-control">
			{{#places}}
			<option value={{id}}>{{place}}</option> {{/places}}

		</select>
	</div>
	<div id='loading'>loading...</div>
	<div id='calendar'></div>
</body>

</html>